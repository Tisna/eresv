(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{627:function(t,e,n){"use strict";(function(t){n(12),n(27),n(38),n(49),n(383),n(55),n(83),n(42),n(228),n(11);e.a={name:"Account",data:function(){return{totalData:0,editedIndex:-1,loading:!0,dialogLoading:!1,selected:[],allData:[],documentType:[],documentStatus:[],itemSearch:[],coordinateData:[],arrayEsign:[],arrayMaterai:[],searchStatus:"draft",searchItem:"",search:"",form:{},defaultItem:{},defaultAction:"Edit",defaultActionText:"Edit",options:{},headers:[{text:"Number",value:"document_number",cellClass:"disable-wrap"},{text:"Document Type",value:"type",cellClass:"disable-wrap"},{text:"Document Date",value:"document_date",cellClass:"disable-wrap"},{text:"Location",value:"location",cellClass:"disable-wrap"},{text:"Value",value:"value",cellClass:"disable-wrap"},{text:"Status",value:"status",cellClass:"disable-wrap"},{text:"Created By",value:"user_create.name",cellClass:"disable-wrap"},{text:"Coordinate",value:"coordinate",align:"center",width:"80px",sortable:!1,filterable:!1},{text:"Actions",value:"id",align:"center",width:"50px",sortable:!1,filterable:!1,cellClass:"disable-wrap"}],url:"/api/document"}},head:function(){return{title:"Documents"}},computed:{formTitle:function(){return-1===this.editedIndex?"New Data":"Edit Data"},buttonTitle:function(){return-1===this.editedIndex?"Save":"Update"},batchItems:function(){return"draft"===this.searchStatus?["Submit Approval","Delete"]:"pending"===this.searchStatus?["Cancel"]:"approved"===this.searchStatus?["Download"]:("canceled"===this.searchStatus||this.searchStatus,[""])}},watch:{options:{handler:function(){this.getDataFromApi()},deep:!0}},methods:{checkColorStatus:function(t){switch(t.status){case"pending":return"bg-orange";case"canceled":return"bg-red";case"approved":return"bg-green";default:return"bg-white"}},newData:function(){this.editedIndex=-1,this.$refs.forms.newData(this.documentType,this.defaultItem)},coordinate:function(data){var t=this;this.coordinateData=[],this.coordinateData=data.data,this.arrayMaterai=[],this.arrayEsign=[];var e=this.arrayMaterai,n=this.arrayEsign;this.dialogLoading=!0,this.coordinateData.forEach((function(element,t){"materai"===element.id?e.push({visLLX:element.boundingBox.left,visLLY:800-parseFloat(element.boundingBox.top),visURX:parseFloat(element.boundingBox.left)+parseFloat(element.boundingBox.width),visURY:800-parseFloat(element.boundingBox.top)-parseFloat(element.boundingBox.height),pageIndex:element.pageIndex}):n.push({visLLX:element.boundingBox.left,visLLY:800-parseFloat(element.boundingBox.top),visURX:parseFloat(element.boundingBox.left)+parseFloat(element.boundingBox.width),visURY:800-parseFloat(element.boundingBox.top)-parseFloat(element.boundingBox.height),pageIndex:element.pageIndex})})),this.$axios.post(this.url+"/update-coordinate",{arrayMaterai:e,arrayEsign:n,id:data.item.id}).then((function(e){t.dialogLoading=!1,t.getDataFromApi()})).finally((function(){return t.dialogLoading=!1}))},openAttchment:function(t){this.$refs.formUpload.newData(t)},eventCountAttachment:function(data){this.getDataFromApi()},actions:function(t,e){switch(t){case"Edit":this.editItem(e);break;case"View Files":this.openAttchment(e);break;case"Submit Approval":this.submitDocument(e);break;case"Cancel Approval":this.cancelDocument(e);break;case"Download Document":this.downloadDocument(e);break;case"Delete":this.batchDeleteDocument([e.id]);break;case"Approval Stages":this.$refs.approvalStages.openApprovalStages(e);break;case"Open Editor":this.$refs.formEditor.newData(e.attachment.file_path,e)}},getItemActions:function(t){return"draft"===t.status?["View Files","Open Editor","Submit Approval","Delete"]:"pending"===t.status?["Approval Stages","Cancel Approval"]:"approved"===t.status?["Edit"]:["View Files","Approval Stages"]},cancelDocument:function(t){var e=this;this.$swal({title:"Are you sure?",text:"Status approval dokumen ini akan diubah menjadi Cancel!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, Cancel!",cancelButtonText:"No",reverseButtons:!0}).then((function(n){if(!0===n.value){var o=e.url+"/cancel-document";e.$axios.post(o,t).then((function(t){e.$swal({title:"Success!",text:t.data.message,type:"success"}),e.getDataFromApi()})).catch((function(t){e.$swal({type:"error",title:"Error",text:t.response.data.message})}))}}))},batchCancelDocument:function(t){var e=this;this.$swal({title:"Are you sure?",text:"Status approval dokumen ini akan diubah menjadi Cancel!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, Cancel!",cancelButtonText:"No",reverseButtons:!0}).then((function(n){if(!0===n.value){var o=e.url+"/batch-cancel-document";e.$axios.post(o,t).then((function(t){e.$swal({title:"Success!",text:t.data.message,type:"success"}),e.getDataFromApi()})).catch((function(t){e.$swal({type:"error",title:"Error",text:t.response.data.message})}))}}))},batchDeleteDocument:function(t){var e=this;this.$swal({title:"Are you sure?",text:"Document will deleted permanently!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, Delete!",cancelButtonText:"No",reverseButtons:!0}).then((function(n){if(!0===n.value){var o=e.url+"/batch-delete-document";e.$axios.delete(o,{params:{id:t}}).then((function(t){e.$swal({title:"Success!",text:t.data.message,type:"success"}),e.getDataFromApi()})).catch((function(t){e.$swal({type:"error",title:"Error",text:t.response.data.message})}))}}))},editItem:function(t){this.editedIndex=this.allData.indexOf(t),this.$refs.forms.editItem(t,this.documentType)},submitDocument:function(t){var e=this;this.dialogLoading=!0,this.$axios.post(this.url+"/approval",{id:t.id}).then((function(t){e.dialogLoading=!1,e.getDataFromApi()})).catch((function(t){e.$swal({type:"error",title:"Error",text:t.response.data.message})})).finally((function(){return e.dialogLoading=!1}))},batchSubmitDocument:function(t){var e=this;this.dialogLoading=!0,this.$axios.post(this.url+"/batch-approval",t).then((function(t){e.dialogLoading=!1,e.getDataFromApi()})).catch((function(t){e.$swal({type:"error",title:"Error",text:t.response.data.message})})).finally((function(){return e.dialogLoading=!1}))},downloadDocument:function(e){var n=this;this.arrayMaterai=[],this.arrayEsign=[],this.dialogLoading=!0,this.$axios.get(this.url+"/download",{params:{id:e.id,type:"single"},responseType:"arraybuffer"}).then((function(t){n.dialogLoading=!1;var o=new Blob([t.data],{type:"application/pdf"}),r=window.URL.createObjectURL(o),link=document.createElement("a");link.href=window.URL.createObjectURL(o),link.download=e.document_number,document.body.appendChild(link),link.click(),setTimeout((function(){document.body.removeChild(link),window.URL.revokeObjectURL(r)}),100)})).finally((function(){return n.dialogLoading=!1})).catch((function(e){var o=JSON.parse(t.from(e.response.data).toString("utf8"));n.$swal({type:"error",title:"Error",text:o.message})}))},emitData:function(data){this.documentStatus=data.documentStatus,this.itemSearch=data.itemSearch,this.searchStatus=data.searchStatus,this.searchItem=data.searchItem,this.search=data.search,this.filters=data.filters,this.getDataFromApi()},batchActions:function(e){var n=this;if(this.selected.length<1)this.$swal({type:"error",title:"Error",text:"Please select at least 1 row!"});else try{var o=this;if("Submit Approval"===e)o.batchSubmitDocument(this.selected);else if("Delete"===e){var r=[];this.selected.forEach((function(t){r.push(t.id)})),o.batchDeleteDocument(r)}else if("Cancel"===e)o.batchCancelDocument(this.selected);else if("Download"===e){var c=[];this.selected.forEach((function(t){c.push(t.id)})),this.dialogLoading=!0,this.$axios.get(this.url+"/download",{params:{id:c,type:"batch"},responseType:"arraybuffer"}).then((function(t){n.dialogLoading=!1;var e=new Blob([t.data],{type:"application/zip"}),o=window.URL.createObjectURL(e),link=document.createElement("a");link.href=window.URL.createObjectURL(e),link.download="E-MATERAI",document.body.appendChild(link),link.click(),setTimeout((function(){document.body.removeChild(link),window.URL.revokeObjectURL(o)}),100)})).catch((function(e){var o=JSON.parse(t.from(e.response.data).toString("utf8"));n.$swal({type:"error",title:"Error",text:o.message})})).finally((function(){return n.dialogLoading=!1}))}}catch(t){this.$swal({type:"error",title:"Error",text:t})}},getDataFromApi:function(){var t=this;this.loading=!0;var e=this;this.$axios.get(this.url,{params:{options:e.options,searchItem:e.searchItem,documentStatus:e.documentStatus,searchStatus:e.searchStatus,search:e.search}}).then((function(e){t.loading=!1,t.allData=e.data.data.rows,t.totalData=e.data.data.total,t.itemSearch=e.data.filter,t.form=Object.assign({},e.data.data.form),t.defaultItem=Object.assign({},e.data.data.form),t.documentStatus=e.data.data.document_status,t.itemSearch=e.data.data.search_item,t.documentType=e.data.data.document_type,t.selected=[]})).catch((function(e){t.loading=!1,t.$swal({type:"error",title:"Error",text:e.response.data.message})}))}}}}).call(this,n(663).Buffer)},681:function(t,e,n){"use strict";n.r(e);var o=n(627).a,r=n(81),c=n(89),l=n.n(c),d=n(106),m=n(843),h=n(126),f=n(258),v=n(174),w=n(50),y=n(568),D=n(261),x=n(257),component=Object(r.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"mx-auto"},[n("v-overlay",{attrs:{value:t.loading}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1),t._v(" "),n("v-data-table",{staticClass:"elevation-1",attrs:{"mobile-breakpoint":0,headers:t.headers,items:t.allData,"items-per-page":20,options:t.options,"server-items-length":t.totalData,loading:t.loading,"show-select":"","fixed-header":"",height:"70vh","item-class":t.checkColorStatus,dense:"","footer-props":{"items-per-page-options":[20,50,100,-1]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"top",fn:function(){return[n("LazyMainToolbar",{attrs:{"document-status":t.documentStatus,"search-status":t.searchStatus,"item-search":t.itemSearch,"search-item":t.searchItem,search:t.search,title:"Documents","show-batch-action":!0,"batch-actions":t.batchItems},on:{emitData:t.emitData,newData:t.newData,batchActions:t.batchActions}})]},proxy:!0},{key:"item.files",fn:function(e){var o=e.item;return[n("v-icon",{staticClass:"mr-2",attrs:{small:"",color:"orange"},on:{click:function(e){return t.openAttchment(o)}}},[t._v("\n          mdi-attachment\n        ")])]}},{key:"item.id",fn:function(e){var o=e.item;return["approved"===o.status?n("v-btn",{staticClass:"font-weight-bold text-right",attrs:{color:"primary",text:"",small:""},on:{click:function(e){return t.actions("Download Document",o)}}},[t._v("\n          Download Document\n        ")]):n("v-btn",{staticClass:"font-weight-bold text-right",attrs:{color:"primary",text:"",small:""},on:{click:function(e){return t.actions("Edit",o)}}},[t._v("\n          Edit\n        ")]),t._v(" "),n("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on,r=e.attrs;return[n("v-btn",t._g(t._b({staticClass:"mr-2",attrs:{color:"black",dark:"",icon:""}},"v-btn",r,!1),o),[n("v-icon",[t._v("mdi-menu-down")])],1)]}}],null,!0)},[t._v(" "),n("v-list",t._l(t.getItemActions(o),(function(e,i){return n("v-list-item",{key:i,on:{click:function(n){return t.actions(e,o)}}},[n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e))])],1)],1)})),1)],1)]}},{key:"item.editor",fn:function(e){var o=e.item;return[o.attachment?n("v-icon",{staticClass:"mr-2",attrs:{small:"",color:"green"},on:{click:function(e){return t.$refs.formEditor.newData(o.attachment.file_path,o)}}},[t._v("\n          mdi-image-edit\n        ")]):t._e()]}},{key:"item.submit",fn:function(e){var o=e.item;return["draft"===o.status&&o.attachment&&o.vis_digisign_llx&&o.vis_llx?n("v-icon",{staticClass:"mr-2",attrs:{small:"",color:"orange"},on:{click:function(e){return t.submitDocument(o)}}},[t._v("\n          mdi-cloud-upload\n        ")]):t._e()]}},{key:"item.download",fn:function(e){var o=e.item;return["approved"===o.status?n("v-icon",{staticClass:"mr-2",attrs:{small:"",color:"orange"},on:{click:function(e){return t.downloadDocument(o)}}},[t._v("\n          mdi-download\n        ")]):t._e()]}},{key:"item.stages",fn:function(e){var o=e.item;return["pending"===o.status?n("v-icon",{staticClass:"mr-2",attrs:{small:"",color:"orange"},on:{click:function(e){return t.$refs.approvalStages.openApprovalStages(o)}}},[t._v("\n          mdi-format-line-weight\n        ")]):t._e()]}},{key:"item.coordinate",fn:function(e){var o=e.item;return[o.attachment&&o.vis_digisign_llx&&o.vis_llx?n("v-icon",{attrs:{color:"green"}},[t._v("mdi-check-all")]):n("v-icon",{attrs:{color:"red"},on:{click:function(e){return t.$refs.formEditor.newData(o.attachment.file_path,o)}}},[t._v("mdi-cancel")])]}}],null,!0),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1),t._v(" "),n("LazyDocumentFormDocument",{ref:"forms",attrs:{"form-data":t.form,"document-type":t.documentType,"form-title":t.formTitle,"button-title":t.buttonTitle,url:t.url},on:{getDataFromApi:t.getDataFromApi}}),t._v(" "),n("LazyDocumentUploadDocument",{ref:"formUpload",attrs:{"form-data":t.form,"document-type":t.documentType,"form-title":"Files","button-title":t.buttonTitle,url:t.url},on:{getDataFromApi:t.getDataFromApi,eventCountAttachment:t.eventCountAttachment}}),t._v(" "),n("LazyDocumentEditor",{ref:"formEditor",attrs:{"form-data":t.form,"document-type":t.documentType,"form-title":t.formTitle,"button-title":t.buttonTitle,url:t.url},on:{coordinate:t.coordinate}}),t._v(" "),t.dialogLoading?n("LazySpinnerLoading",{ref:"spinnerLoadingImport"}):t._e(),t._v(" "),n("LazyResvApprovalDetails",{ref:"approvalStages"})],1)}),[],!1,null,null,null);e.default=component.exports;l()(component,{VBtn:d.a,VDataTable:m.a,VIcon:h.a,VList:f.a,VListItem:v.a,VListItemContent:w.a,VListItemTitle:w.c,VMenu:y.a,VOverlay:D.a,VProgressCircular:x.a})}}]);